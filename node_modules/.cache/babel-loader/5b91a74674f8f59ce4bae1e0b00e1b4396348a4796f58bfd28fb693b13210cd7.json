{"ast":null,"code":"export default {\n  name: 'HelloWorld',\n  props: {\n    msg: String\n  }\n};","map":{"version":3,"names":["name","props","msg","String"],"sources":["src/components/HelloWorld.vue"],"sourcesContent":["<template>\n\t<el-row type=\"flex\" class=\"sku-info\">\n\t\t<el-col v-for=\"(attr, index) in process_attribute\" :key=\"index\">\n\t\t\t<h3>{{ attr.name }}</h3>\n\t\t\t<el-button-group>\n\t\t\t\t<el-button v-for=\"(item, index2) in attr.item\" :key=\"index2\" :type=\"item.actived ? 'primary' : ''\" :disabled=\"item.disabled\" @click=\"skuClick(index, index2)\">{{ item.name }}</el-button>\n\t\t\t</el-button-group>\n\t\t</el-col>\n\t</el-row>\n\t<div style=\"margin-top: 20px;\">\n\t\t库存：\n\t\t<span>{{ stock }}</span>\n\t</div>\n\t<div style=\"margin-bottom: 20px;\">\n\t\t价格：\n\t\t<span v-if=\"minprice == maxprice\">{{ minprice }}</span>\n\t\t<span v-else>{{ minprice }} - {{ maxprice }}</span>\n\t</div>\n\t<el-button type=\"primary\" @click=\"submit\">购买</el-button>\n\t<el-row type=\"flex\" :gutter=\"20\">\n\t\t<el-col>\n\t\t\t<el-divider content-position=\"left\">加工处理过的 attribute 数据</el-divider>\n\t\t\t<pre><code>{{ process_attribute }}</code></pre>\n\t\t</el-col>\n\t\t<el-col>\n\t\t\t<el-divider content-position=\"left\">加工处理过的 sku 数据</el-divider>\n\t\t\t<pre><code>{{ process_sku }}</code></pre>\n\t\t</el-col>\n\t</el-row>\n</template>\n\n<script>\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\t// sku字段分隔符\n\t\t\tseparator: ';',\n\t\t\tattribute: [\n\t\t\t\t{\n\t\t\t\t\tname: '颜色',\n\t\t\t\t\titem: ['黑', '金', '白']\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: '内存',\n\t\t\t\t\titem: ['16G', '32G']\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: '运营商',\n\t\t\t\t\titem: ['电信', '移动', '联通']\n\t\t\t\t}\n\t\t\t],\n\t\t\tsku: [\n\t\t\t\t{ sku: '黑;16G;电信', price: 100, stock: 10 },\n\t\t\t\t{ sku: '黑;16G;移动', price: 101, stock: 11 },\n\t\t\t\t{ sku: '黑;16G;联通', price: 102, stock: 0 },\n\t\t\t\t{ sku: '黑;32G;电信', price: 103, stock: 13},\n\t\t\t\t{ sku: '黑;32G;移动', price: 104, stock: 14},\n\t\t\t\t{ sku: '黑;32G;联通', price: 105, stock: 0},\n\t\t\t\t{ sku: '金;16G;电信', price: 106, stock: 16},\n\t\t\t\t{ sku: '金;16G;移动', price: 107, stock: 17},\n\t\t\t\t{ sku: '金;16G;联通', price: 108, stock: 18},\n\t\t\t\t{ sku: '金;32G;电信', price: 109, stock: 0},\n\t\t\t\t{ sku: '金;32G;移动', price: 110, stock: 20},\n\t\t\t\t{ sku: '金;32G;联通', price: 111, stock: 21},\n\t\t\t\t{ sku: '白;16G;电信', price: 112, stock: 0},\n\t\t\t\t{ sku: '白;16G;移动', price: 113, stock: 23},\n\t\t\t\t{ sku: '白;16G;联通', price: 114, stock: 24},\n\t\t\t\t{ sku: '白;32G;电信', price: 115, stock: 0},\n\t\t\t\t{ sku: '白;32G;移动', price: 116, stock: 26},\n\t\t\t\t{ sku: '白;32G;联通', price: 117, stock: 27}\n\t\t\t],\n\t\t\tprocess_attribute: [],\n\t\t\tprocess_sku: [],\n\t\t\t// 当前选中 sku 的库存及价格区间\n\t\t\tstock: '',\n\t\t\tminprice: '',\n\t\t\tmaxprice: ''\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.init()\n\t},\n\tmethods: {\n\t\tinit() {\n\t\t\t// 对 attribute 数据进行加工，并存入 process_attribute 中\n\t\t\tthis.attribute.map(attr => {\n\t\t\t\tlet temp = {\n\t\t\t\t\tname: attr.name\n\t\t\t\t}\n\t\t\t\ttemp.item = attr.item.map(item => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: item,\n\t\t\t\t\t\tactived: false,\n\t\t\t\t\t\tdisabled: false\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.process_attribute.push(temp)\n\t\t\t})\n\t\t\t// 对 sku 数据进行加工，并存入 process_sku 中\n\t\t\tthis.sku.map(v => {\n\t\t\t\tvar combArr = this.arrayCombine(v.sku.split(this.separator))\n\t\t\t\tfor (var j = 0; j < combArr.length; j++) {\n\t\t\t\t\tvar key = combArr[j].join(this.separator)\n\t\t\t\t\tif (this.process_sku[key]) {\n\t\t\t\t\t\t// 库存累加，价格添加进数组\n\t\t\t\t\t\tthis.process_sku[key].stock += v.stock\n\t\t\t\t\t\tthis.process_sku[key].prices.push(v.price)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.process_sku[key] = {\n\t\t\t\t\t\t\tstock: v.stock,\n\t\t\t\t\t\t\tprices: [v.price]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t// 更新数据视图\n\t\t\tthis.process_sku = Object.assign({}, this.process_sku)\n\t\t\tthis.skuCheck()\n\t\t},\n\t\tarrayCombine(targetArr) {\n\t\t\tvar resultArr = []\n\t\t\tfor (var n = 0; n <= targetArr.length; n++) {\n\t\t\t\tvar flagArrs = this.getFlagArrs(targetArr.length, n)\n\t\t\t\twhile (flagArrs.length) {\n\t\t\t\t\tvar flagArr = flagArrs.shift()\n\t\t\t\t\tvar combArr = Array(targetArr.length)\n\t\t\t\t\tfor (var i = 0; i < targetArr.length; i++) {\n\t\t\t\t\t\tif (flagArr[i]) {\n\t\t\t\t\t\t\tcombArr[i] = targetArr[i]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresultArr.push(combArr)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn resultArr\n\t\t},\n\t\tgetFlagArrs(m, n) {\n\t\t\tvar flagArrs = [],\n\t\t\t\tflagArr = [],\n\t\t\t\tisEnd = false\n\t\t\tfor (var i = 0; i < m; i++) {\n\t\t\t\tflagArr[i] = i < n ? 1 : 0\n\t\t\t}\n\t\t\tflagArrs.push(flagArr.concat())\n\t\t\t// 当n不等于0并且m大于n的时候进入\n\t\t\tif (n && m > n) {\n\t\t\t\twhile (!isEnd) {\n\t\t\t\t\tvar leftCnt = 0\n\t\t\t\t\tfor (var i = 0; i < m - 1; i++) {\n\t\t\t\t\t\tif (flagArr[i] == 1 && flagArr[i + 1] == 0) {\n\t\t\t\t\t\t\tfor (var j = 0; j < i; j++) {\n\t\t\t\t\t\t\t\tflagArr[j] = j < leftCnt ? 1 : 0\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tflagArr[i] = 0\n\t\t\t\t\t\t\tflagArr[i + 1] = 1\n\t\t\t\t\t\t\tvar aTmp = flagArr.concat()\n\t\t\t\t\t\t\tflagArrs.push(aTmp)\n\t\t\t\t\t\t\tif (aTmp.slice(-n).join('').indexOf('0') == -1) {\n\t\t\t\t\t\t\t\tisEnd = true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tflagArr[i] == 1 && leftCnt++\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn flagArrs\n\t\t},\n\t\tskuClick(key1, key2) {\n\t\t\tif (!this.process_attribute[key1].item[key2].disabled) {\n\t\t\t\tthis.process_attribute[key1].item.map((item, index) => {\n\t\t\t\t\titem.actived = index == key2 ? !item.actived : false\n\t\t\t\t})\n\t\t\t\tthis.skuCheck()\n\t\t\t\tthis.getStockPrice()\n\t\t\t}\n\t\t},\n\t\tskuCheck() {\n\t\t\tlet sku = []\n\t\t\tthis.process_attribute.map(attr => {\n\t\t\t\tlet name = ''\n\t\t\t\tattr.item.map(item => {\n\t\t\t\t\tif (item.actived) {\n\t\t\t\t\t\tname = item.name\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tsku.push(name)\n\t\t\t})\n\t\t\tthis.stock = this.process_sku[sku.join(this.separator)].stock\n\t\t\tthis.minprice = Math.min.apply(Math, this.process_sku[sku.join(this.separator)].prices)\n\t\t\tthis.maxprice = Math.max.apply(Math, this.process_sku[sku.join(this.separator)].prices)\n\t\t},\n\t\tgetStockPrice() {\n\t\t\tthis.process_attribute.map(attr => {\n\t\t\t\tattr.item.map(item => {\n\t\t\t\t\titem.disabled = false\n\t\t\t\t})\n\t\t\t})\n\t\t\tlet count = 0\n\t\t\tlet i = 0\n\t\t\tthis.process_attribute.map((attr, index) => {\n\t\t\t\tlet flag = false\n\t\t\t\tattr.item.map(item => {\n\t\t\t\t\tif (item.actived) {\n\t\t\t\t\t\tflag = true\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (!flag) {\n\t\t\t\t\tcount += 1\n\t\t\t\t\ti = index\n\t\t\t\t}\n\t\t\t})\n\t\t\t// 当只有一组规格没选时\n\t\t\tif (count == 1) {\n\t\t\t\tthis.process_attribute[i].item.map(item => {\n\t\t\t\t\tlet sku = []\n\t\t\t\t\tlet text = item.name\n\t\t\t\t\tthis.process_attribute.map((attr, index) => {\n\t\t\t\t\t\tif (index != i) {\n\t\t\t\t\t\t\tattr.item.map(item2 => {\n\t\t\t\t\t\t\t\tif (item2.actived) {\n\t\t\t\t\t\t\t\t\tsku.push(item2.name)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsku.push(text)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tif (this.process_sku[sku.join(this.separator)].stock == 0) {\n\t\t\t\t\t\titem.disabled = true\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\t// 当所有规格都有选时\n\t\t\tif (count == 0) {\n\t\t\t\tthis.process_attribute.map((attr, index) => {\n\t\t\t\t\tlet i = index\n\t\t\t\t\tthis.process_attribute[index].item.map(item => {\n\t\t\t\t\t\tif (!item.actived) {\n\t\t\t\t\t\t\tlet sku = []\n\t\t\t\t\t\t\tlet text = item.name\n\t\t\t\t\t\t\tthis.process_attribute.map((list, index) => {\n\t\t\t\t\t\t\t\tif (index != i) {\n\t\t\t\t\t\t\t\t\tlist.item.map(item2 => {\n\t\t\t\t\t\t\t\t\t\tif (item2.actived) {\n\t\t\t\t\t\t\t\t\t\t\tsku.push(item2.name)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsku.push(text)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tif (this.process_sku[sku.join(this.separator)].stock == 0) {\n\t\t\t\t\t\t\t\titem.disabled = true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tsubmit() {\n\t\t\tlet sku = []\n\t\t\tlet isSelectSKU = this.process_attribute.every(attr => {\n\t\t\t\tlet filter = attr.item.filter(v => v.actived)\n\t\t\t\tif (filter.length != 0) {\n\t\t\t\t\tsku.push(filter[0].name)\n\t\t\t\t}\n\t\t\t\treturn filter.length != 0\n\t\t\t})\n\t\t\tif (isSelectSKU) {\n\t\t\t\tthis.$message.success(`当前SKU为：${sku.join(this.separator)}`)\n\t\t\t} else {\n\t\t\t\tthis.$message.warning('请选择完整商品属性')\n\t\t\t}\n\t\t}\n\t}\n}\n</script>\n\n<script>\nexport default {\n  name: 'HelloWorld',\n  props: {\n    msg: String\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n</style>\n"],"mappings":"AAwRA;EACAA,IAAA;EACAC,KAAA;IACAC,GAAA,EAAAC;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}